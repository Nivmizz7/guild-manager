# Discord OAuth Setup Guide

## Prerequisites
- A Discord account
- A Discord server where you want to manage guild access
- Admin access to create a Discord application

## Step 1: Create a Discord Application

1. Go to https://discord.com/developers/applications
2. Click "New Application"
3. Give it a name (e.g., "WoW Guild Manager")
4. Click "Create"

## Step 2: Get Your Client ID and Secret

1. In your application page, go to "OAuth2" → "General"
2. Copy the **Client ID** - you'll need this for `.env`
3. Click "Reset Secret" and copy the **Client Secret** - you'll need this for `.env`
4. Add a redirect URL: `http://localhost:3001/api/auth/discord/callback`
   - Click "Add Redirect" and paste the URL
   - Click "Save Changes"

## Step 3: Get Your Discord Server (Guild) ID

1. Open Discord
2. Go to User Settings → Advanced
3. Enable "Developer Mode"
4. Right-click on your server name
5. Click "Copy Server ID"

## Step 4: Get Your Admin Role ID

1. In Discord, go to Server Settings → Roles
2. Create a new role for guild admins (e.g., "Guild Officer")
3. Right-click on the role
4. Click "Copy Role ID"

## Step 5: Configure the Backend

1. Navigate to the `backend` folder
2. Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```

3. Edit `.env` and fill in your values:
   ```
   DISCORD_CLIENT_ID=123456789012345678
   DISCORD_CLIENT_SECRET=your_client_secret_here
   DISCORD_REDIRECT_URI=http://localhost:3001/api/auth/discord/callback
   DISCORD_GUILD_ID=987654321098765432
   DISCORD_ADMIN_ROLE_ID=111222333444555666
   SESSION_SECRET=a_random_long_string_for_security
   FRONTEND_URL=http://localhost:3000
   ```

4. Save the file

## Step 6: Invite the Bot (Optional but recommended)

For better role verification, add the bot to your server:

1. Go to your Discord Application
2. Click "OAuth2" → "URL Generator"
3. Select scopes: `bot`
4. Select bot permissions: `Read Messages/View Channels`
5. Copy the generated URL and open it in your browser
6. Select your server and authorize

## Permission Levels

- **No login**: Read-only access to public data
- **Discord login without admin role**: Read-only access
- **Discord login with admin role**: Full access (create, edit, delete)

## Security Notes

- Never share your `.env` file
- Never commit `.env` to git (it's in .gitignore)
- Change `SESSION_SECRET` to a random string
- For production, update `DISCORD_REDIRECT_URI` and `FRONTEND_URL` to your domain

## Testing

1. Start the application: `npm start`
2. Go to http://localhost:3000
3. Click "Login with Discord"
4. Authorize the application
5. You should be logged in with appropriate permissions based on your role

## Troubleshooting

- **Redirect URI mismatch**: Make sure the redirect URI in Discord matches exactly with the one in `.env`
- **Invalid client**: Double-check your Client ID and Secret
- **Role not detected**: Make sure the bot is in your server and can see roles
- **Session issues**: Clear cookies and restart the server
